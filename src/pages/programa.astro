---
import LayoutRegister from "../layouts/LayoutRegister.astro";
import programs from "../data/constans_program.ts";
import Button from "../components/schedule/Button.astro";
import Conference from "../components/schedule/Conference.astro";
---

<LayoutRegister title="ITM | Directorio Digital 2024">
  <main class="mx-5 md:mx-16 lg:mx-32 pb-5">
    <h1 class="text-left text-[#E42128] text-5xl font-extrabold py-5">
      Programa
    </h1>
    <section>
      <h3 class="text-3xl pb-3">Escenarios</h3>
      <div class="md:ml-5">
        <Button id="stage-1">Transformation Area</Button>
        <Button id="stage-2">Leaders of Tomorrow Arena</Button>
      </div>
      <div
        class="w-full bg-gradient-to-br from-[#E42128] to-[#CF1363] h-[1px] mt-1 mb-3 rounded-sm"
      >
      </div>
      <div class="md:ml-5 *:w-full md:*:w-fit">
        <Button id="day-1">Día 1<br />Miércoles, 6 de noviembre</Button>
        <Button id="day-2">Día 2<br />Jueves, 7 de noviembre</Button>
        <Button id="day-3">Día 3<br />Viernes, 8 de noviembre</Button>
      </div>
      {
        programs.map((program) => (
          <section
            class="mt-5 hidden"
            id={`program-${program.stage}-${program.day}`}
          >
            {program.conferences.map((item, key) => (
              <Conference item={item} key={program.stage + "-" + program.day + "-" + key}/>
            ))}
          </section>
        ))
      }
    </section>
  </main>
</LayoutRegister>
<style>
  body {
    background-color: #111827;
    color: white;
  }
</style>
<script>
  const state = {
    stage: 1,
    day: 1,
  };
  const url = new URL(window.location.href);

  function showProgram(stage: number, day: number) {
    if (state.stage === stage && state.day === day) return;

    let programElement;
    programElement = document.getElementById(
      `program-${state.stage}-${state.day}`,
    );
    if (programElement !== null) {
      programElement.style.display = "none";
    }
    programElement = document.getElementById(`program-${stage}-${day}`);
    if (programElement !== null) {
      programElement.style.display = "block";
    }

    url.searchParams.set("stage", stage.toString());
    url.searchParams.set("day", day.toString());
    window.history.pushState({}, "", url);

    state.stage = stage;
    state.day = day;
  }

  function changeOpacityStageBts(stage: number) {
    document
      .getElementById("stage-1")
      ?.firstElementChild?.classList.remove("bg-opacity-0");
    document
      .getElementById("stage-2")
      ?.firstElementChild?.classList.remove("bg-opacity-0");
    document
      .getElementById(`stage-${stage}`)
      ?.firstElementChild?.classList.add("bg-opacity-0");
  }

  function changeOpacityDayBts(day: number) {
    document
      .getElementById("day-1")
      ?.firstElementChild?.classList.remove("bg-opacity-0");
    document
      .getElementById("day-2")
      ?.firstElementChild?.classList.remove("bg-opacity-0");
    document
      .getElementById("day-3")
      ?.firstElementChild?.classList.remove("bg-opacity-0");
    document
      .getElementById(`day-${day}`)
      ?.firstElementChild?.classList.add("bg-opacity-0");
  }

  function initProgram() {
    const stage = Number(url.searchParams.get("stage")) || 1;
    const day = Number(url.searchParams.get("day")) || 1;

    state.stage = stage;
    state.day = day;

    const programElement = document.getElementById(`program-${stage}-${day}`);
    if (programElement) {
      programElement.style.display = "block";
    }

    changeOpacityStageBts(stage);
    changeOpacityDayBts(day);
  }

  function main() {
    initProgram();

    document.getElementById("stage-1")?.addEventListener("click", (e) => {
      changeOpacityStageBts(1);
      showProgram(1, state.day);
    });
    document.getElementById("stage-2")?.addEventListener("click", (e) => {
      changeOpacityStageBts(2);
      showProgram(2, state.day);
    });

    document.getElementById("day-1")?.addEventListener("click", (e) => {
      changeOpacityDayBts(1);
      showProgram(state.stage, 1);
    });
    document.getElementById("day-2")?.addEventListener("click", (e) => {
      changeOpacityDayBts(2);
      showProgram(state.stage, 2);
    });
    document.getElementById("day-3")?.addEventListener("click", (e) => {
      changeOpacityDayBts(3);
      showProgram(state.stage, 3);
    });
  }

  document.addEventListener("astro:page-load", main);
</script>
